<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="icon" href="data:," />
    <title>Stop & Go Race</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Baloo+2:wght@400;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" as="style" crossorigin href="https://cdn.jsdelivr.net/gh/orioncactus/pretendard@v1.3.9/dist/web/variable/pretendardvariable.min.css" />
    <style>
      :root{
        --W: 854px; 
        --H: 600px;
        /* Clean Vivid Palette for 7-year-olds */
        --soil-1: #F2B36C;   /* 따뜻한 베이지 */
        --soil-2: #E8A858;   /* 밝은 골드 */
        --grain:  rgba(200,130,80,.2); /* 부드러운 나무 음영 */
        --moss:   #49D86D;   /* 밝은 녹색 */
        --leaf:   #5FE87D;   /* 생생한 연두 */
        --shadow: rgba(0,0,0,.15);
        
        /* 추가 Vivid 팔레트 */
        --bright-green: #49D86D;
        --sunny-yellow: #FFD84C;
        --sky-blue: #42BFFF;
        --coral-red: #FF5D5D;
        --warm-beige: #F2B36C;
      }

      body {
        font-family: 'Pretendard Variable', Pretendard, -apple-system, BlinkMacSystemFont, system-ui, Roboto, 'Helvetica Neue', 'Segoe UI', 'Apple SD Gothic Neo', 'Noto Sans KR', 'Malgun Gothic', 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol', sans-serif;
        user-select: none;
        margin: 0;
        padding: 0;
        background-color: #87CEEB; /* Sky Blue */
        overflow: auto; /* 스크롤 허용 */
        min-height: 100vh;
        position: relative;
      }

      /* 중앙 일자길 */
      .trail{
        position: absolute;
        top: -50px; /* 상단으로 50px 더 올려서 완전히 닿도록 */
        left: 50%;
        transform: translateX(-50%);
        width: 800px; /* 고정 너비 800px */
        height: 120%; /* 높이를 줄여서 플레이어가 보이도록 */
        border-radius: 0;
        z-index: 20; /* Round 1 텍스트 위로 표시 */

        /* 배경 이미지에 길이 포함되어 있으므로 CSS 배경 숨김 */
        background: transparent !important;

        box-shadow: none;

        /* 깊이감 제거 */
        filter: none;
        
        /* 트랙 가장자리 그라데이션 제거 */
        position: relative;
      }


      /* SEA THEME - Round 2 */
      .sea .trail{
        width: 800px;  /* 고정 너비 800px */
        border-radius: 0;

        /* 배경 이미지에 길이 포함되어 있으므로 CSS 배경 숨김 */
        background: transparent !important;
        box-shadow: none;
        filter: none;
        
        /* 트랙 가장자리 그라데이션 제거 */
        position: relative;
      }

      /* 산호/해초 가장자리 - 숨김처리 */
      .sea .trail::after{
        display: none;
      }
      .sea .trail::before{ left: 0; }
      .sea .trail::after { right: 0; }

      /* 바다 터널 - 최고 우선순위 선택자 */
      .fishway.glass .trail, .fishway .glass .trail, .fishway .trail, div.fishway.glass .trail, div.fishway .glass .trail, div.fishway .trail{
        width: 800px;
        border-radius: 0;
        /* 배경 이미지에 길이 포함되어 있으므로 CSS 배경 숨김 */
        background: transparent !important;
        overflow:hidden;
        box-shadow: none;
        filter: none;
      }

      /* 물 흐름 효과 - 숨김처리 */
      .fishway.glass .trail::after, .fishway .glass .trail::after, .fishway .trail::after{
        display: none;
      }

      /* 애니메이션 */
      @keyframes waterFlow{
        from{ background-position: 0 100%; }
        to  { background-position: 0 -150%; }
      }

      /* SPACE STATION THEME - Round 3 */
      .space .trail{
        width: 800px;
        border-radius: 0;
        /* 배경 이미지에 길이 포함되어 있으므로 CSS 배경 숨김 */
        background: transparent !important;
        box-shadow: none;
        filter: none;
        
        /* 트랙 가장자리 그라데이션 제거 */
        position: relative;
      }


      /* 점수 펄스 애니메이션 */
      @keyframes score-pop{
        0% { transform: scale(1); }
        50% { transform: scale(1.15); }
        100% { transform: scale(1); }
      }
      .score-pop { animation: score-pop 0.3s ease-out; }

      /* 화면 흔들림 */
      @keyframes screen-shake{
        0%, 100% { transform: translateX(0); }
        25% { transform: translateX(-8px) rotate(-1deg); }
        75% { transform: translateX(8px) rotate(1deg); }
      }
      .screen-shake { animation: screen-shake 0.5s; }

      #stage {
        width: 1280px;
        height: 800px;
        position: absolute;
        top: 0;
        left: 50%;
        transform-origin: top center;
        transform: translateX(-50%);
        overflow: hidden;
      }

      #root {
        width: 100%;
        height: 100%;
      }
      @keyframes shield-pulse {
          0% { filter: drop-shadow(0 0 0 rgba(255, 255, 255, 0.7)); }
          50% { filter: drop-shadow(0 0 15px rgba(52, 152, 219, 0.9)); }
          100% { filter: drop-shadow(0 0 0 rgba(255, 255, 255, 0.7)); }
      }
      @keyframes slowed-pulse {
          0% { filter: drop-shadow(0 0 0 rgba(255, 255, 255, 0.7)); }
          50% { filter: drop-shadow(0 0 20px #F44336); }
          100% { filter: drop-shadow(0 0 0 rgba(255, 255, 255, 0.7)); }
      }
      @keyframes shake {
          0%, 100% { margin-left: 0; filter: none; }
          25% { margin-left: -10px; filter: brightness(1.1); }
          50% { margin-left: 10px; filter: brightness(0.9); }
          75% { margin-left: -10px; filter: brightness(1.1); }
      }
      @keyframes item-appear {
          from { transform: scale(0.5) translateX(-50%); opacity: 0; }
          to { transform: scale(1) translateX(-50%); opacity: 1; }
      }
      @keyframes item-disappear {
          from { transform: scale(1) translateX(-50%); opacity: 1; }
          to { transform: scale(0.5) translateX(-50%); opacity: 0; }
      }

      /* Ambient Cloud Drift */
      @keyframes cloud-drift {
        0% { transform: translateX(0) scale(var(--cloud-scale,1)); }
        50% { transform: translateX(15px) translateY(-3px) scale(var(--cloud-scale,1)); }
        100% { transform: translateX(0) scale(var(--cloud-scale,1)); }
      }

      /* Traffic Light Glow Pulse */
      @keyframes light-glow {
        0% { box-shadow: 0 0 8px var(--glow-color, transparent); }
        50% { box-shadow: 0 0 22px var(--glow-color, transparent); }
        100% { box-shadow: 0 0 8px var(--glow-color, transparent); }
      }

      /* 강화된 Boost Speedlines */
      @keyframes speedlines-fade {
        0% { opacity: 0; transform: translate(-50%, -10px) scaleY(0.9); }
        20% { opacity: 1; }
        100% { opacity: 0; transform: translate(-50%, -30px) scaleY(1.2); }
      }
      .speedlines::before,
      .speedlines::after {
        content: "";
        position: absolute;
        left: 50%;
        transform: translateX(-50%);
        width: 32px;
        height: 60px;
        border-radius: 16px;
        background: linear-gradient(180deg, rgba(73,216,109,0.5), rgba(255,216,76,0.4), rgba(255,255,255,0));
        filter: blur(2px);
        animation: speedlines-fade 0.3s linear infinite;
        pointer-events: none;
        box-shadow: 0 0 10px rgba(73,216,109,0.3);
      }
      .speedlines::after {
        width: 22px;
        height: 42px;
        animation-delay: 0.12s;
      }

      /* 먼지 트레일 강화 */
      @keyframes dust-puff {
        0% { opacity: 0.5; transform: translate(-50%, 0) scale(0.8); }
        50% { opacity: 0.3; }
        100% { opacity: 0; transform: translate(-50%, 20px) scale(1.5); }
      }
      .dust-trail {
        position: absolute;
        bottom: -10px;
        left: 50%;
        width: 30px;
        height: 30px;
        background: radial-gradient(circle, rgba(242,179,108,0.4), transparent 70%);
        filter: blur(6px);
        animation: dust-puff 0.6s ease-out infinite;
        pointer-events: none;
      }

      /* 강화된 Frozen Frost Ring */
      @keyframes frost-ring {
        0% { box-shadow: 0 0 0 0 rgba(66,191,255,0.9), 0 0 0 0 rgba(173,216,230,0.6); }
        50% { box-shadow: 0 0 20px 8px rgba(66,191,255,0.9), 0 0 35px 12px rgba(173,216,230,0.7); }
        100% { box-shadow: 0 0 0 0 rgba(66,191,255,0.9), 0 0 0 0 rgba(173,216,230,0.6); }
      }
      .frost-ring {
        position: absolute;
        top: -8px;
        left: 50%;
        transform: translateX(-50%);
        width: 60px;
        height: 60px;
        border-radius: 9999px;
        border: 3px solid rgba(200, 240, 255, 0.95);
        backdrop-filter: blur(2px);
        animation: frost-ring 1s ease-in-out infinite;
        pointer-events: none;
        background: radial-gradient(circle, rgba(66,191,255,0.1), transparent 70%);
      }

      /* 강화된 Slow Mud Splash */
      @keyframes mud-splash {
        0% { transform: translate(-50%, 0) scale(0.9); opacity: 0.7; }
        50% { transform: translate(-50%, -5px) scale(1.1); opacity: 1; }
        100% { transform: translate(-50%, 0) scale(0.9); opacity: 0.7; }
      }
      .mud-splash {
        position: absolute;
        bottom: -8px;
        left: 50%;
        transform: translateX(-50%);
        width: 52px;
        height: 14px;
        background: radial-gradient(ellipse at center, rgba(139,90,43, 0.9), rgba(160,110,60,0.5) 50%, transparent 75%);
        border-radius: 9999px;
        filter: blur(1px);
        animation: mud-splash 0.8s ease-in-out infinite;
        pointer-events: none;
        box-shadow: 0 2px 6px rgba(110, 66, 28, 0.3);
      }

      /* Button Glow for GO */
      @keyframes button-glow {
        0% { box-shadow: 0 0 10px rgba(46, 204, 113, 0.6); }
        50% { box-shadow: 0 0 26px rgba(46, 204, 113, 0.95); }
        100% { box-shadow: 0 0 10px rgba(46, 204, 113, 0.6); }
      }
      .button-green-glow { animation: button-glow 1.2s ease-in-out infinite; }

      /* Sun pulse */
      @keyframes sun-pulse {
        0% { box-shadow: 0 0 0 0 rgba(255, 215, 0, 0.6); transform: scale(1); }
        50% { box-shadow: 0 0 35px 8px rgba(255, 215, 0, 0.9); transform: scale(1.03); }
        100% { box-shadow: 0 0 0 0 rgba(255, 215, 0, 0.6); transform: scale(1); }
      }
      .sun-pulse { animation: sun-pulse 2.5s ease-in-out infinite; }

      /* Hill gentle sway */
      @keyframes hill-sway {
        0%, 100% { transform: translateX(0); }
        50% { transform: translateX(6px); }
      }
      .hill-sway { animation: hill-sway 6s ease-in-out infinite; }

      /* Flag wave */
      @keyframes flag-wave {
        0% { transform: skewX(0deg); }
        50% { transform: skewX(-6deg); }
        100% { transform: skewX(0deg); }
      }
      .flag-wave { animation: flag-wave 1.2s ease-in-out infinite; transform-origin: left center; }

      /* Banner bounce */
      @keyframes banner-bounce {
        0%, 100% { transform: translate(-50%, 0); }
        50% { transform: translate(-50%, -6px); }
      }
      .banner-bounce { animation: banner-bounce 2s ease-in-out infinite; }

      /* Status Aura (positive/negative) */
      @keyframes aura-pulse-red {
        0% { box-shadow: 0 0 0 0 rgba(231, 76, 60, 0.55), inset 0 0 0 0 rgba(231, 76, 60, 0.25); }
        50% { box-shadow: 0 0 26px 6px rgba(231, 76, 60, 0.85), inset 0 0 8px 0 rgba(231, 76, 60, 0.25); }
        100% { box-shadow: 0 0 0 0 rgba(231, 76, 60, 0.55), inset 0 0 0 0 rgba(231, 76, 60, 0.25); }
      }
      @keyframes aura-pulse-blue {
        0% { box-shadow: 0 0 0 0 rgba(52, 152, 219, 0.55), inset 0 0 0 0 rgba(52, 152, 219, 0.25); }
        50% { box-shadow: 0 0 26px 6px rgba(52, 152, 219, 0.85), inset 0 0 8px 0 rgba(52, 152, 219, 0.25); }
        100% { box-shadow: 0 0 0 0 rgba(52, 152, 219, 0.55), inset 0 0 0 0 rgba(52, 152, 219, 0.25); }
      }
      .status-aura {
        position: absolute; top: -10px; left: 50%; transform: translateX(-50%);
        width: 60px; height: 60px; border-radius: 9999px; pointer-events: none;
        background: radial-gradient(circle, rgba(255,255,255,0.15) 0 30%, rgba(255,255,255,0) 60%);
      }
      .status-aura.red { animation: aura-pulse-red 1s ease-in-out infinite; }
      .status-aura.blue { animation: aura-pulse-blue 1s ease-in-out infinite; }

      /* Outline glows that follow emoji glyphs */
      .aura-outline-red {
        text-shadow:
          0 0 6px rgba(231,76,60,0.7),
          0 0 12px rgba(231,76,60,0.6),
          0 0 18px rgba(231,76,60,0.5);
        filter: drop-shadow(0 0 6px rgba(231,76,60,0.35));
      }
      .aura-outline-blue {
        text-shadow:
          0 0 6px rgba(52,152,219,0.7),
          0 0 12px rgba(52,152,219,0.6),
          0 0 18px rgba(52,152,219,0.5);
        filter: drop-shadow(0 0 6px rgba(52,152,219,0.35));
      }

      /* CSS Runner Character */
      .css-runner {
        position: relative;
        width: 40px;
        height: 60px;
        margin: 0 auto;
      }

      /* Head */
      .runner-head {
        position: absolute;
        top: 0;
        left: 50%;
        transform: translateX(-50%);
        width: 12px;
        height: 12px;
        background: #FFB366;
        border-radius: 50%;
        border: 2px solid #333;
      }

      /* Body */
      .runner-body {
        position: absolute;
        top: 12px;
        left: 50%;
        transform: translateX(-50%);
        width: 8px;
        height: 20px;
        background: #4A90E2;
        border-radius: 4px;
      }

      /* Team Colors */
      .css-runner.team-red .runner-body {
        background: #FF5E5E;
      }
      .css-runner.team-blue .runner-body {
        background: #5B9DFF;
      }

      /* Arms */
      .runner-arm {
        position: absolute;
        top: 15px;
        width: 3px;
        height: 12px;
        background: #FFB366;
        border-radius: 2px;
        transform-origin: top center;
      }
      .runner-arm.left {
        left: 8px;
      }
      .runner-arm.right {
        right: 8px;
      }

      /* Legs */
      .runner-leg {
        position: absolute;
        top: 30px;
        width: 4px;
        height: 15px;
        background: #333;
        border-radius: 2px;
        transform-origin: top center;
      }
      .runner-leg.left {
        left: 14px;
      }
      .runner-leg.right {
        right: 14px;
      }

      /* Feet */
      .runner-foot {
        position: absolute;
        bottom: -3px;
        width: 8px;
        height: 3px;
        background: #333;
        border-radius: 2px;
        left: -2px;
      }

      /* Running Animation */
      @keyframes run-cycle {
        0% {
          transform: translateY(0);
        }
        25% {
          transform: translateY(-4px);
        }
        50% {
          transform: translateY(0);
        }
        75% {
          transform: translateY(-2px);
        }
        100% {
          transform: translateY(0);
        }
      }

      /* Rabbit Sprite Animation - 6x6 grid, 36 frames (Team A - Red) */
      /* 전체 이미지: 780x1662px, 각 프레임: 130x277px */
      /* 각 프레임의 정확한 위치를 계산하여 순차적으로 표시 */
      @keyframes rabbit-sprite-run {
        /* 프레임 0-5 (1행) */
        0% { background-position: 0px 0px; }
        2.777% { background-position: -130px 0px; }
        5.555% { background-position: -260px 0px; }
        8.333% { background-position: -390px 0px; }
        11.111% { background-position: -520px 0px; }
        13.888% { background-position: -650px 0px; }
        /* 프레임 6-11 (2행) */
        16.666% { background-position: 0px -277px; }
        19.444% { background-position: -130px -277px; }
        22.222% { background-position: -260px -277px; }
        25% { background-position: -390px -277px; }
        27.777% { background-position: -520px -277px; }
        30.555% { background-position: -650px -277px; }
        /* 프레임 12-17 (3행) */
        33.333% { background-position: 0px -554px; }
        36.111% { background-position: -130px -554px; }
        38.888% { background-position: -260px -554px; }
        41.666% { background-position: -390px -554px; }
        44.444% { background-position: -520px -554px; }
        47.222% { background-position: -650px -554px; }
        /* 프레임 18-23 (4행) */
        50% { background-position: 0px -831px; }
        52.777% { background-position: -130px -831px; }
        55.555% { background-position: -260px -831px; }
        58.333% { background-position: -390px -831px; }
        61.111% { background-position: -520px -831px; }
        63.888% { background-position: -650px -831px; }
        /* 프레임 24-29 (5행) */
        66.666% { background-position: 0px -1108px; }
        69.444% { background-position: -130px -1108px; }
        72.222% { background-position: -260px -1108px; }
        75% { background-position: -390px -1108px; }
        77.777% { background-position: -520px -1108px; }
        80.555% { background-position: -650px -1108px; }
        /* 프레임 30-35 (6행) */
        83.333% { background-position: 0px -1385px; }
        86.111% { background-position: -130px -1385px; }
        88.888% { background-position: -260px -1385px; }
        91.666% { background-position: -390px -1385px; }
        94.444% { background-position: -520px -1385px; }
        97.222% { background-position: -650px -1385px; }
        100% { background-position: 0px 0px; }
      }
      
      /* Fox Sprite Animation - 6x6 grid, 36 frames (Team B - Blue) */
      /* 전체 이미지: 1224x1650px, 각 프레임: 204x275px */
      /* 각 프레임의 정확한 위치를 계산하여 순차적으로 표시 */
      @keyframes fox-sprite-run {
        /* 프레임 0-5 (1행) */
        0% { background-position: 0px 0px; }
        2.777% { background-position: -204px 0px; }
        5.555% { background-position: -408px 0px; }
        8.333% { background-position: -612px 0px; }
        11.111% { background-position: -816px 0px; }
        13.888% { background-position: -1020px 0px; }
        /* 프레임 6-11 (2행) */
        16.666% { background-position: 0px -275px; }
        19.444% { background-position: -204px -275px; }
        22.222% { background-position: -408px -275px; }
        25% { background-position: -612px -275px; }
        27.777% { background-position: -816px -275px; }
        30.555% { background-position: -1020px -275px; }
        /* 프레임 12-17 (3행) */
        33.333% { background-position: 0px -550px; }
        36.111% { background-position: -204px -550px; }
        38.888% { background-position: -408px -550px; }
        41.666% { background-position: -612px -550px; }
        44.444% { background-position: -816px -550px; }
        47.222% { background-position: -1020px -550px; }
        /* 프레임 18-23 (4행) */
        50% { background-position: 0px -825px; }
        52.777% { background-position: -204px -825px; }
        55.555% { background-position: -408px -825px; }
        58.333% { background-position: -612px -825px; }
        61.111% { background-position: -816px -825px; }
        63.888% { background-position: -1020px -825px; }
        /* 프레임 24-29 (5행) */
        66.666% { background-position: 0px -1100px; }
        69.444% { background-position: -204px -1100px; }
        72.222% { background-position: -408px -1100px; }
        75% { background-position: -612px -1100px; }
        77.777% { background-position: -816px -1100px; }
        80.555% { background-position: -1020px -1100px; }
        /* 프레임 30-35 (6행) */
        83.333% { background-position: 0px -1375px; }
        86.111% { background-position: -204px -1375px; }
        88.888% { background-position: -408px -1375px; }
        91.666% { background-position: -612px -1375px; }
        94.444% { background-position: -816px -1375px; }
        97.222% { background-position: -1020px -1375px; }
        100% { background-position: 0px 0px; }
      }
      
      .rabbit-sprite {
        background-image: url('/sprite/rabbit_running.png');
        /* 전체 이미지 크기: 780x1662px */
        /* 각 프레임 크기: 130x277px */
        /* 컨테이너 크기: 40px × 85px */
        /* background-size를 전체 이미지 크기로 설정하고, 컨테이너가 각 프레임만 보이도록 함 */
        background-size: 780px 1662px; /* 전체 스프라이트 시트 크기 */
        background-repeat: no-repeat;
        background-position: 0 0;
        animation: rabbit-sprite-run 4.5s steps(36, end) infinite; /* 36단계로 나누어 각 프레임 표시 */
        width: 40px;
        height: 85px;
        display: block;
        image-rendering: pixelated;
        image-rendering: -moz-crisp-edges;
        image-rendering: crisp-edges;
      }
      
      .fox-sprite {
        background-image: url('/sprite/fox_running.png');
        /* 전체 이미지 크기: 1224x1650px */
        /* 각 프레임 크기: 204x275px */
        /* 컨테이너 크기: 40px × 54px */
        /* background-size를 전체 이미지 크기로 설정하고, 컨테이너가 각 프레임만 보이도록 함 */
        background-size: 1224px 1650px; /* 전체 스프라이트 시트 크기 */
        background-repeat: no-repeat;
        background-position: 0 0;
        animation: fox-sprite-run 4.5s steps(36, end) infinite; /* 36단계로 나누어 각 프레임 표시 */
        width: 40px;
        height: 54px;
        display: block;
        image-rendering: pixelated;
        image-rendering: -moz-crisp-edges;
        image-rendering: crisp-edges;
      }
      
      @keyframes rabbit-run {
        0% { background-position: 0px 0px; }
        6.25% { background-position: -65px 0px; }
        12.5% { background-position: -130px 0px; }
        18.75% { background-position: -195px 0px; }
        25% { background-position: 0px -92px; }
        31.25% { background-position: -65px -92px; }
        37.5% { background-position: -130px -92px; }
        43.75% { background-position: -195px -92px; }
        50% { background-position: 0px -184px; }
        56.25% { background-position: -65px -184px; }
        62.5% { background-position: -130px -184px; }
        68.75% { background-position: -195px -184px; }
        75% { background-position: 0px -276px; }
        81.25% { background-position: -65px -276px; }
        87.5% { background-position: -130px -276px; }
        93.75% { background-position: -195px -276px; }
        100% { background-position: 0px 0px; }
      }

      @keyframes leg-run-left {
        0% { transform: rotate(20deg); }
        25% { transform: rotate(-10deg); }
        50% { transform: rotate(-20deg); }
        75% { transform: rotate(10deg); }
        100% { transform: rotate(20deg); }
      }

      @keyframes leg-run-right {
        0% { transform: rotate(-20deg); }
        25% { transform: rotate(10deg); }
        50% { transform: rotate(20deg); }
        75% { transform: rotate(-10deg); }
        100% { transform: rotate(-20deg); }
      }

      @keyframes arm-run-left {
        0% { transform: rotate(-15deg); }
        50% { transform: rotate(15deg); }
        100% { transform: rotate(-15deg); }
      }

      @keyframes arm-run-right {
        0% { transform: rotate(15deg); }
        50% { transform: rotate(-15deg); }
        100% { transform: rotate(15deg); }
      }

      /* Emoji Runner Animations (fallback) */
      @keyframes runner-bob {
        0%, 100% { transform: translateY(0) scaleX(1); }
        25% { transform: translateY(-8px) scaleX(1.05); }
        75% { transform: translateY(-4px) scaleX(0.95); }
      }
      @keyframes cheer-jump {
        0%, 100% { transform: translateY(0) scale(1); }
        50% { transform: translateY(-25px) scale(1.2); }
      }
      
      /* 자연스러운 콘페티 폭발 효과 */
      @keyframes confetti-natural {
        0% { 
          transform: translate(0, 0) scale(0.3) rotate(0deg); 
          opacity: 1; 
        }
        20% { 
          transform: translate(calc(var(--burst-x, 0) * 0.4), calc(var(--burst-y, 0) * 0.4)) scale(1) rotate(calc(var(--burst-rotation, 0) * 0.2)); 
          opacity: 1; 
        }
        60% { 
          transform: translate(calc(var(--burst-x, 0) * 0.8), calc(var(--burst-y, 0) * 0.8 + 20px * var(--burst-gravity, 1))) scale(0.8) rotate(calc(var(--burst-rotation, 0) * 0.6)); 
          opacity: 0.7; 
        }
        100% { 
          transform: translate(calc(var(--burst-x, 0) * 1.2), calc(var(--burst-y, 0) * 1.2 + 60px * var(--burst-gravity, 1))) scale(0.3) rotate(var(--burst-rotation, 0)); 
          opacity: 0; 
        }
      }
      .confetti-natural {
        position: absolute;
        border-radius: 50%;
        box-shadow: 0 2px 4px rgba(0,0,0,0.2);
        animation: confetti-natural ease-out forwards;
      }
      
      /* GO Button Pulse Animation */
      @keyframes go-pulse {
        0% { transform: scale(1); }
        50% { transform: scale(1.05); }
        100% { transform: scale(1); }
      }


      .animation-shield-pulse { animation: shield-pulse 1.5s infinite; }
      .animation-slowed-pulse { animation: slowed-pulse 1s infinite; }
      .animation-shake { animation: shake 0.5s; }
      .animation-item-appear { animation: item-appear 0.5s forwards; }
      .animation-item-disappear { animation: item-disappear 0.5s forwards; }
      .animation-runner-bob { animation: runner-bob 0.3s infinite ease-in-out; }
      .animation-cheer-jump { animation: cheer-jump 0.8s infinite; }
      .animation-go-pulse { animation: go-pulse 1.5s infinite; }

      /* Utility classes for light glow based on active state */
      .glow-red { --glow-color: rgba(231,76,60,0.9); animation: light-glow 1.2s ease-in-out infinite; }
      .glow-yellow { --glow-color: rgba(241,196,15,0.9); animation: light-glow 0.9s ease-in-out infinite; }
      .glow-green { --glow-color: rgba(46,204,113,0.9); animation: light-glow 0.9s ease-in-out infinite; }

      /* CSS Runner Animations */
      .css-runner.running {
        animation: run-cycle 0.4s infinite ease-in-out;
      }
      .css-runner.running .runner-leg.left {
        animation: leg-run-left 0.4s infinite ease-in-out;
      }
      .css-runner.running .runner-leg.right {
        animation: leg-run-right 0.4s infinite ease-in-out;
      }
      .css-runner.running .runner-arm.left {
        animation: arm-run-left 0.4s infinite ease-in-out;
      }
      .css-runner.running .runner-arm.right {
        animation: arm-run-right 0.4s infinite ease-in-out;
      }

      /* 화면 전환 애니메이션 */
      /* 페이드 전환 효과 */
      @keyframes fadeTransition {
        from {
          opacity: 0;
        }
        to {
          opacity: 1;
        }
      }

      @keyframes fadeTransitionExit {
        from {
          opacity: 1;
        }
        to {
          opacity: 0;
        }
      }

      .fade-transition-enter {
        opacity: 0;
      }

      .fade-transition-enter-active {
        animation: fadeTransition 0.5s ease-in-out forwards;
      }

      .fade-transition-exit {
        opacity: 1;
      }

      .fade-transition-exit-active {
        animation: fadeTransitionExit 0.5s ease-in-out forwards;
      }

      /* 스크린 전환 효과 (스케일 + 페이드) */
      @keyframes screenTransition {
        from {
          opacity: 0;
          transform: scale(0.95) translateY(20px);
        }
        to {
          opacity: 1;
          transform: scale(1) translateY(0);
        }
      }

      .screen-transition-enter {
        opacity: 0;
        transform: scale(0.95) translateY(20px);
      }

      .screen-transition-enter-active {
        animation: screenTransition 0.5s cubic-bezier(0.4, 0, 0.2, 1) forwards;
      }

      /* 슬라이드 전환 효과 */
      @keyframes slideTransition {
        from {
          opacity: 0;
          transform: translateX(100%);
        }
        to {
          opacity: 1;
          transform: translateX(0);
        }
      }

      .slide-transition-enter {
        opacity: 0;
        transform: translateX(100%);
      }

      .slide-transition-enter-active {
        animation: slideTransition 0.6s cubic-bezier(0.4, 0, 0.2, 1) forwards;
      }

      /* 퀴즈 팝업 애니메이션 */
      @keyframes pop-in {
        0% {
          opacity: 0;
          transform: scale(0.8);
        }
        100% {
          opacity: 1;
          transform: scale(1);
        }
      }

      @keyframes pop-in-large {
        0% {
          opacity: 0;
          transform: scale(0.5);
        }
        70% {
          opacity: 1;
          transform: scale(1.1);
        }
        100% {
          opacity: 1;
          transform: scale(1);
        }
      }

      .animate-pop-in {
        animation: pop-in 0.3s ease-out forwards;
      }

      .animate-pop-in-large {
        animation: pop-in-large 0.5s ease-out forwards;
      }

      /* 퀴즈 버튼 스타일 */
      .quiz-btn {
        background: #ffffff;
        border: 3px solid rgba(0,0,0,0.1);
        border-radius: 1.5rem;
        padding: 2rem;
        font-size: 1.875rem;
        font-weight: bold;
        color: #374151;
        cursor: pointer;
        transition: all 0.2s ease;
        box-shadow: 0 4px 12px rgba(0,0,0,0.2);
      }

      .quiz-btn:hover:not(:disabled) {
        transform: translateY(-2px);
        box-shadow: 0 6px 16px rgba(0,0,0,0.3);
      }

      .quiz-btn:active:not(:disabled) {
        transform: scale(0.95) translateY(1px);
      }

      .quiz-btn:disabled {
        cursor: not-allowed;
        opacity: 0.7;
      }

      .quiz-btn.correct-answer {
        background: #10B981;
        color: white;
        border-color: #059669;
        box-shadow: 0 4px 12px rgba(16, 185, 129, 0.4);
      }

      .quiz-btn.incorrect-answer {
        background: #EF4444;
        color: white;
        border-color: #DC2626;
        box-shadow: 0 4px 12px rgba(239, 68, 68, 0.4);
      }

      .quiz-locked {
        pointer-events: none;
      }

      /* 동동 떠있는 효과 */
      @keyframes float {
        0%, 100% {
          transform: translateY(0px);
        }
        50% {
          transform: translateY(-10px);
        }
      }
    </style>
  <script type="importmap">
{
  "imports": {
    "react": "https://esm.sh/react@^19.1.1",
    "react-dom/": "https://esm.sh/react-dom@^19.1.1/",
    "react/": "https://esm.sh/react@^19.1.1/",
    "@google/genai": "https://esm.sh/@google/genai@^1.15.0"
  }
}
</script>
<link rel="stylesheet" href="/index.css">
</head>
  <body>
    <noscript>You need to enable JavaScript to run this app.</noscript>
    <div id="stage">
      <div id="root"></div>
    </div>
    <script type="module" src="/index.tsx"></script>
    <script>
      /* 스케일 조정을 위한 JavaScript 함수 */
      function updateStageScale() {
        const stage = document.getElementById('stage');
        if (stage) {
          // 스케일 계산: min(window.innerWidth/1280, window.innerHeight/800)
          const scaleX = window.innerWidth / 1280;
          const scaleY = window.innerHeight / 800;
          const scale = Math.min(scaleX, scaleY);

          // transform-origin: top center, 스케일 적용
          stage.style.transformOrigin = 'top center';
          stage.style.transform = `translateX(-50%) scale(${scale})`;

          // body의 높이를 스케일된 stage 높이에 맞춤
          const scaledHeight = 800 * scale;
          document.body.style.minHeight = scaledHeight + 'px';

          // 스크롤 처리: 필요시만 표시
          if (scaledHeight > window.innerHeight) {
            document.body.style.overflow = 'auto';
          } else {
            document.body.style.overflow = 'hidden';
          }
        }
      }

      /* 초기 로드 및 리사이즈 이벤트 */
      document.addEventListener('DOMContentLoaded', updateStageScale);
      window.addEventListener('resize', updateStageScale);
    </script>
  </body>
</html>